var inicio={loginForm:function(){var identificador=document.getElementById("email").value,nombre=document.getElementById("nombre").value,foto="views/img/intro/anonymous.png";""!=identificador&&""!=nombre&&inicio.login(identificador,nombre,foto)},ocultarMsgTouch:function(){var obj=document.getElementById("loginTouch");obj.parentNode.removeChild(obj)},iniciar:function(){var identificador="mabc@live.cl",nombre="Marcelo Bravo",foto="views/img/intro/pedro.png";inicio.login(identificador,nombre,foto)},login:function(identificador,nombre,foto){var xhr=new XMLHttpRequest,url="views/ajax/usuarios.php";xhr.open("POST",url,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send("identificador="+identificador+"&nombre="+nombre+"&foto="+foto),xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&("ok"==xhr.responseText?window.location="inicio":alert(xhr.responseText))}},iniciarFacebook:function(){function validarUsuario(){FB.getLoginStatus(function(response){statusChangeCallback(response)})}function statusChangeCallback(response){"connected"===response.status?testAPI():document.getElementById("ingresoFacebook").innerHTML='<div style="color: white; text-align:center"> ¡Vuelve a intentarlo!</div>'}function testAPI(){FB.api("/me?fields=id, name, first_name, last_name, email, picture",function(response){var xhr=new XMLHttpRequest,identificador=response.email,nombre=response.name,foto="http://graph.facebook.com/"+response.id+"/picture?type=large",url="views/ajax/usuarios.php";xhr.open("POST",url,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send("identificador="+identificador+"&nombre="+nombre+"&foto="+foto),xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&("ok"==xhr.responseText?window.location="inicio":alert(xhr.responseText))}})}FB.login(function(response){validarUsuario()},{scope:"public_profile, email"})},cesrrarSesionFacebook:function(){FB.getLoginStatus(function(response){"connected"===response.status&&FB.logout(function(response){setTimeout(function(){window.location="salir"},500)})})},compartirFacebook:function(e){var jugador=e.getAttribute("nombreJugador");FB.ui({method:"share",display:"popup",quote:"¡"+jugador+" ha ganado "+datos.sResumenPuntaje+" pts en el nivel "+datos.nivel+" en el juego Black Nija.",link:"http://mabc.byethost9.com/blackninja"},function(response){})},elegirNivel:function(e){datos.nivel=e.getAttribute("nivel"),datos.id=e.getAttribute("id"),inicio.inicioDeNiveles(datos.nivel)},inicioDeNiveles:function(nivel){document.getElementById("inicio").parentNode.removeChild(document.getElementById("inicio")),datos.nivel=nivel,window.matchMedia("(max-width: 1024px)").matches&&screen.fullScreen(),inicio.preparaNiveles()},siguienteNivel:function(){datos.nivel++,window.matchMedia("(max-width: 1024px)").matches&&screen.fullScreen(),inicio.preparaNiveles()},preparaNiveles:function(){datos.imgColisionTrampa=new Image,datos.imgJumpLeft=new Image,datos.imgJumpRight=new Image,datos.imgRunLefth=new Image,datos.imgRunRight=new Image,datos.imgStopLeft=new Image,datos.imgStopRight=new Image,datos.imgColisionesBalas=new Image,datos.imgColisionesBalasEnemigos=new Image,datos.imgColisionesMonedas=new Image,datos.imgColisionesTrampas=new Image,datos.img_monedas=new Image,datos.img_trampas=new Image,datos.imgBalasJugador=new Image,datos.imgDisparoEnemigos=new Image,datos.imgVidaMenos=new Image,datos.imgColisionTrampa.src="views/img/jugador/colision_trampa.png",datos.imgJumpLeft.src="views/img/jugador/jump_left.png",datos.imgJumpRight.src="views/img/jugador/jump_right.png",datos.imgRunLefth.src="views/img/jugador/run_left.png",datos.imgRunRight.src="views/img/jugador/run_right.png",datos.imgStopLeft.src="views/img/jugador/stop_left.png",datos.imgStopRight.src="views/img/jugador/stop_right.png",datos.imgColisionesBalas.src="views/img/utileria/colisionesBalas.png",datos.imgColisionesBalasEnemigos.src="views/img/utileria/colisionesBalasEnemigos.png",datos.imgColisionesMonedas.src="views/img/utileria/colisionesMonedas.png",datos.imgColisionesTrampas.src="views/img/utileria/colisionesTrampas.png",datos.img_monedas.src="views/img/utileria/monedas.png",datos.img_trampas.src="views/img/utileria/trampas.png",datos.imgBalasJugador.src="views/img/utileria/balasJugador.png",datos.imgDisparoEnemigos.src="views/img/utileria/balasEnemigos.png",datos.imgVidaMenos.src="views/img/jugador/vida_menos.png",sonidos.sBackground01=document.getElementById("sBackground01"),sonidos.sBackground02=document.getElementById("sBackground02"),sonidos.sBackground03=document.getElementById("sBackground03"),sonidos.sColisionBalasEnemigo=document.getElementById("sColisionBalasEnemigo"),sonidos.sColisionTrampasEnemigos=document.getElementById("sColisionTrampasEnemigos"),sonidos.sDisparoEnemigo=document.getElementById("sDisparoEnemigo"),sonidos.sDisparoJugador=document.getElementById("sDisparoJugador"),sonidos.sEnergia=document.getElementById("sEnergia"),sonidos.sGanar=document.getElementById("sGanar"),sonidos.sMonedas=document.getElementById("sMonedas"),sonidos.sMonedero=document.getElementById("sMonedero"),sonidos.sPerder=document.getElementById("sPerder"),sonidos.sPerderVida=document.getElementById("sPerderVida"),sonidos.sPuntos=document.getElementById("sPuntos"),sonidos.sSaltoJugador=document.getElementById("sSaltoJugador"),sonidos.sResumenPuntaje=document.getElementById("sResumenPuntaje"),sonidos.listaSonidos=document.getElementsByClassName("sonidos");for(var i=sonidos.listaSonidos.length-1;i>=0;i--)sonidos.listaSonidos[i].play(),sonidos.listaSonidos[i].pause(),sonidos.listaSonidos[i].muted=!1;canvas=document.getElementById("lienzo"),ctx=canvas.getContext("2d"),document.getElementById("carga").style.display="block",datos.plano3=new Image,datos.plano3.src="views/img/nivel"+datos.nivel+"/plano3.png",datos.plano2=new Image,datos.plano2.src="views/img/nivel"+datos.nivel+"/plano2.png",datos.plano1=new Image,datos.plano1.src="views/img/nivel"+datos.nivel+"/plano1.png",datos.texturaPlataforma=new Image,datos.texturaPlataforma.src="views/img/nivel"+datos.nivel+"/texturaPlataforma.jpg";var xhr=new XMLHttpRequest;xhr.open("GET","views/js/json/nivel"+datos.nivel+"/bloques.json",!0),xhr.send(),datos.bloques=[],xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&(datos.bloques=JSON.parse(xhr.responseText))},datos.plano0=new Image,datos.plano0.src="views/img/nivel"+datos.nivel+"/plano0.png",datos.detalles=new Image,datos.detalles.src="views/img/nivel"+datos.nivel+"/detalles.png";var xhrPosDetalles=new XMLHttpRequest;xhrPosDetalles.open("GET","views/js/json/nivel"+datos.nivel+"/posicionDetalles.json",!0),xhrPosDetalles.send(),datos.posDetalles=[],xhrPosDetalles.onreadystatechange=function(){4==xhrPosDetalles.readyState&&200==xhrPosDetalles.status&&(datos.posDetalles=JSON.parse(xhrPosDetalles.responseText))};var xhrPlataforma=new XMLHttpRequest;xhrPlataforma.open("GET","views/js/json/nivel"+datos.nivel+"/plataforma.json",!0),xhrPlataforma.send(),datos.plataformaOrigen=[],xhrPlataforma.onreadystatechange=function(){4==xhrPlataforma.readyState&&200==xhrPlataforma.status&&(datos.plataformaOrigen=JSON.parse(xhrPlataforma.responseText),datos.plataforma=JSON.parse(JSON.stringify(datos.plataformaOrigen)))};var xhrPosMonedas=new XMLHttpRequest;xhrPosMonedas.open("GET","views/js/json/nivel"+datos.nivel+"/posicion_monedas.json",!0),xhrPosMonedas.send(),datos.posicionMonedas=[],datos.imgMonedas=[],xhrPosMonedas.onreadystatechange=function(){if(4==xhrPosMonedas.readyState&&200==xhrPosMonedas.status){datos.posicionMonedas=JSON.parse(xhrPosMonedas.responseText);for(var i=0;i<datos.posicionMonedas.length;i++)datos.imgMonedas[i]=new Image,datos.imgMonedas[i].src=datos.img_monedas.src}},datos.monedasColisionadas=[];var xhrPosTrampas=new XMLHttpRequest;xhrPosTrampas.open("GET","views/js/json/nivel"+datos.nivel+"/posicion_trampas.json",!0),xhrPosTrampas.send(),datos.posicionTrampas=[],datos.imgTrampas=[],xhrPosTrampas.onreadystatechange=function(){if(4==xhrPosTrampas.readyState&&200==xhrPosTrampas.status){datos.posicionTrampas=JSON.parse(xhrPosTrampas.responseText);for(var i=0;i<datos.posicionTrampas.length;i++)datos.imgTrampas[i]=new Image,datos.imgTrampas[i].src=datos.img_trampas.src}};var xhrPosEnemigos=new XMLHttpRequest;xhrPosEnemigos.open("GET","views/js/json/nivel"+datos.nivel+"/posicion_enemigos.json",!0),xhrPosEnemigos.send(),datos.imgEnemigos=new Image,datos.imgEnemigos.src="views/img/utileria/enemigos.png",datos.posicionEnemigos=[],datos.imgBalasEnemigos=[],xhrPosEnemigos.onreadystatechange=function(){4==xhrPosEnemigos.readyState&&200==xhrPosEnemigos.status&&(datos.posicionEnemigos=JSON.parse(xhrPosEnemigos.responseText),datos.posicionBalasEnemigos=JSON.parse(xhrPosEnemigos.responseText),datos.posicionBalasEnemigos.forEach(function(elem,index){datos.imgBalasEnemigos[index]=new Image,datos.imgBalasEnemigos[index].src=datos.imgDisparoEnemigos.src}))},datos.imgJugador=new Image,datos.imgJugador.src="views/img/jugador/stop_right.png";for(var cargarArchivo=[datos.plano0,datos.texturaPlataforma,datos.detalles,datos.plano1,datos.plano2,datos.plano3,datos.imgJugador,datos.imgEnemigos,datos.imgDisparoEnemigos,datos.imgColisionTrampa,datos.imgJumpLeft,datos.imgJumpRight,datos.imgRunLefth,datos.imgRunRight,datos.imgStopLeft,datos.imgStopRight,datos.imgColisionesBalas,datos.imgColisionesBalasEnemigos,datos.imgColisionesMonedas,datos.imgColisionesTrampas,datos.img_monedas,datos.img_trampas,datos.imgVidaMenos],numeroArchivos=0,porcentajeCarga=0,i=0;i<cargarArchivo.length;i++)cargarArchivo[i].addEventListener("load",precarga);function precarga(e){numeroArchivos++,porcentajeCarga=Math.ceil(100*numeroArchivos/cargarArchivo.length),document.getElementById("infoPreload").innerHTML=porcentajeCarga+"%",document.getElementById("medidorPorcentajeCarga").value=porcentajeCarga,numeroArchivos===cargarArchivo.length&&(document.getElementById("lienzo").style.display="block",document.getElementById("btnAmpliar").style.display="block",document.getElementById("btnFullScreen").style.display="block",document.getElementById("tablero").style.display="block",document.getElementById("controlesTouch").style.display="block",setTimeout(function(){document.getElementById("final").style.display="none",document.getElementById("carga").style.opacity=0,datos.contadorMonedasNivel=0,datos.penalizacionVidas=0,datos.gameOver=!1,setTimeout(function(){document.getElementById("carga").style.display="none"},10),juego.controlesTouch(),juego.teclado(),juego.tiempo()},1500))}}};