var juego={volumen:function(event){for(var volumen=eval(event.getAttribute("volumen")),botonesSonido=document.getElementsByClassName("volumen"),i=0;i<sonidos.listaSonidos.length;i++)sonidos.listaSonidos[i].volume=volumen;document.getElementById("lblVolumen").style.textDecoration=0==volumen?"line-through":"none",botonesSonido[0].style.opacity=volumen<.3?.5:1,botonesSonido[1].style.opacity=volumen<.6?.5:1,botonesSonido[2].style.opacity=volumen<1?.5:1},teclado:function(){document.addEventListener("keydown",juego.oprimir),document.addEventListener("keyup",juego.soltar)},controlesTouch:function(){document.getElementById("btnIzquierda").addEventListener("touchstart",function(e){e.preventDefault(),datos.izquierda=!0,datos.direccionJugador="izq"}),document.getElementById("btnIzquierda").addEventListener("touchend",function(e){e.preventDefault(),datos.izquierda=!1,datos.imgJugador.src=datos.imgStopLeft.src}),document.getElementById("btnDerecha").addEventListener("touchstart",function(e){e.preventDefault(),datos.derecha=!0,datos.direccionJugador="der"}),document.getElementById("btnDerecha").addEventListener("touchend",function(e){e.preventDefault(),datos.derecha=!1,datos.imgJugador.src=datos.imgStopRight.src}),document.getElementById("btnSalto").addEventListener("touchstart",function(e){e.preventDefault(),datos.salto=!0,sonidos.sSaltoJugador.play()}),document.getElementById("btnSalto").addEventListener("touchend",function(e){e.preventDefault(),datos.salto=!1}),document.getElementById("btnDisparo").addEventListener("touchstart",function(e){e.preventDefault(),datos.imgDisparoJugador[datos.imgDisparoJugador.length]=new Image,datos.imgDisparoJugador[datos.imgDisparoJugador.length-1].src=datos.imgBalasJugador.src,datos.disparo_x[datos.disparo_x.length]=datos.jugador_x+datos.jugador_ancho/2,datos.disparo_y[datos.disparo_y.length]=datos.jugador_y+datos.jugador_alto/2,datos.disparo_ancho[datos.disparo_ancho.length]=15,datos.disparo_alto[datos.disparo_alto.length]=15,datos.direccionDisparo[datos.direccionDisparo.length]=datos.direccionJugador,datos.disparoActivado=!1,sonidos.sDisparoJugador.play()}),document.getElementById("btnDisparo").addEventListener("touchend",function(e){e.preventDefault(),datos.disparoActivado=!0})},oprimir:function(tecla){tecla.preventDefault(),37!==tecla.keyCode||datos.gameOver||(datos.izquierda=!0,datos.direccionJugador="izq"),39!==tecla.keyCode||datos.gameOver||(datos.derecha=!0,datos.direccionJugador="der"),38!==tecla.keyCode||datos.gameOver||(datos.salto=!0,sonidos.sSaltoJugador.play()),32!==tecla.keyCode||datos.gameOver||datos.disparoActivado&&(datos.imgDisparoJugador[datos.imgDisparoJugador.length]=new Image,datos.imgDisparoJugador[datos.imgDisparoJugador.length-1].src=datos.imgBalasJugador.src,datos.disparo_x[datos.disparo_x.length]=datos.jugador_x+datos.jugador_ancho/2,datos.disparo_y[datos.disparo_y.length]=datos.jugador_y+datos.jugador_alto/2,datos.disparo_ancho[datos.disparo_ancho.length]=15,datos.disparo_alto[datos.disparo_alto.length]=15,datos.direccionDisparo[datos.direccionDisparo.length]=datos.direccionJugador,datos.disparoActivado=!1,sonidos.sDisparoJugador.play())},soltar:function(tecla){tecla.preventDefault(),37===tecla.keyCode&&(datos.izquierda=!1,datos.imgJugador.src=datos.imgStopLeft.src),39===tecla.keyCode&&(datos.derecha=!1,datos.imgJugador.src=datos.imgStopRight.src),38===tecla.keyCode&&(datos.salto=!1,datos.imgJugador.src=datos.imgStopRight.src),32===tecla.keyCode&&(datos.disparo=!1),32===tecla.keyCode&&(datos.disparoActivado=!0)},tiempo:function(){switch(lienzo.canvas(),datos.nivel){case"1":case 1:sonidos.sBackground01.play(),sonidos.sBackground01.loop=!0;break;case"2":case 2:sonidos.sBackground02.play(),sonidos.sBackground02.loop=!0;break;case"3":case 3:sonidos.sBackground03.play(),sonidos.sBackground03.loop=!0}datos.movTrampa<=-50&&(datos.cambioMovTrampa=!1),datos.movTrampa>=100&&(datos.cambioMovTrampa=!0),datos.movTrampa+=datos.cambioMovTrampa?-1:1,datos.cicloSprite=datos.cicloSprite>=500?0:datos.cicloSprite+20;for(var i=0;i<=datos.cicloSprite;i+=100)datos.sprite=i;if(datos.jugador_y>500&&(datos.reiniciar=!0),datos.reiniciar)if(document.getElementById("imgVida"+datos.vida).src=datos.imgVidaMenos.src,1==datos.vida)juegoTerminado();else{sonidos.sPerderVida.play(),datos.reiniciar=!1,juego.resetearDatos(),document.getElementById("contadorMonedas").innerHTML=datos.contadorMonedas,datos.vida--,datos.penalizacionVidas+=10;var xhrPlataforma=new XMLHttpRequest;xhrPlataforma.open("GET","views/js/json/nivel"+datos.nivel+"/plataforma.json",!0),xhrPlataforma.send(),xhrPlataforma.onreadystatechange=function(){4==xhrPlataforma.readyState&&200==xhrPlataforma.status&&(datos.plataforma=JSON.parse(xhrPlataforma.responseText))}}datos.desplazamientoEscenario<=datos.limiteEscenario&&(datos.jugador_x+=datos.movimientoJugador);for(var i=0;i<datos.plataforma.length;i++)datos.plataforma[i].x=datos.plataforma[i].x+datos.movimiento;datos.desplazamientoEscenario+=datos.movimiento,(datos.izquierda||datos.derecha)&&(datos.desplazamientoEscenario>=0?datos.movimiento=0:datos.desplazamientoEscenario<=0&&(datos.jugador_x<=70?datos.movimiento=datos.velocidad:(datos.movimiento=0,datos.movimientoJugador=-datos.velocidadJugador)),0==datos.gravedad&&(datos.imgJugador.src=datos.imgRunLefth.src),datos.salto&&0==datos.gravedad&&(datos.imgJugador.src=datos.imgJumpLeft.src)),datos.derecha||datos.izquierda||(datos.movimiento=0),datos.derecha&&(datos.desplazamientoEscenario<=datos.limiteEscenario?(datos.movimiento=0,datos.movimientoJugador=datos.velocidadJugador):datos.movimiento=-datos.velocidad,0==datos.gravedad&&(datos.imgJugador.src=datos.imgRunRight.src),datos.salto&&0==datos.gravedad&&(datos.imgJugador.src=datos.imgJumpRight.src)),datos.derecha||datos.izquierda||(datos.movimiento=0,datos.movimientoJugador=0),datos.jugador_y+=datos.gravedad,datos.gravedad<datos.limiteGravedad&&(datos.gravedad+=datos.pesoPersonaje);for(var i=0;i<datos.plataforma.length;i++)reaccionandoAColisiones(colisiones(i),i),datos.salto&&0===datos.gravedad&&datos.jugador_y+datos.jugador_alto==datos.plataforma[i].y&&(datos.gravedad=datos.alturaSalto);function colisiones(i){return!(datos.jugador_y+datos.jugador_alto<datos.plataforma[i].y)&&(!(datos.jugador_y>datos.plataforma[i].y+datos.plataforma[i].alto)&&(!(datos.jugador_x+datos.jugador_ancho<datos.plataforma[i].x)&&!(datos.jugador_x>datos.plataforma[i].x+datos.plataforma[i].ancho)))}function reaccionandoAColisiones(colision,i){colision&&datos.jugador_y+datos.jugador_alto<datos.plataforma[i].y+datos.gravedad&&(datos.gravedad=0,datos.jugador_y=datos.plataforma[i].y-datos.jugador_alto),colision&&datos.jugador_y-datos.gravedad>datos.plataforma[i].y+datos.plataforma[i].alto&&(datos.gravedad=1,datos.jugador_y=datos.plataforma[i].y+datos.plataforma[i].alto),movimiento=datos.desplazamientoEscenario<=datos.limiteEscenario?datos.movimientoJugador:-datos.movimiento,colision&&datos.jugador_x+datos.jugador_ancho<datos.plataforma[i].x+movimiento&&(datos.desplazamientoEscenario<=datos.limiteEscenario?datos.movimientoJugador=0:datos.movimiento=0,datos.jugador_x=datos.plataforma[i].x-datos.jugador_ancho),colision&&datos.jugador_x+-movimiento>datos.plataforma[i].x+datos.plataforma[i].ancho&&(datos.desplazamientoEscenario<=datos.limiteEscenario?datos.movimientoJugador=0:datos.movimiento=0,datos.jugador_x=datos.plataforma[i].x+datos.plataforma[i].ancho)}for(var i=0;i<datos.posicionTrampas.length;i++)colisionesTrampas(i)?(sonidos.sColisionTrampasEnemigos.play(),sonidos.sEnergia.play(),datos.imgTrampas[i].src=datos.imgColisionesTrampas.src,datos.imgJugador.src=datos.imgColisionTrampa.src,datos.energia-=datos.energiaTrampa,datos.penalizacionEnergia+=datos.energiaTrampa):datos.imgTrampas[i].src=datos.img_trampas.src;function colisionesTrampas(i){return!(datos.jugador_y+datos.jugador_alto<datos.posicionTrampas[i].y)&&(!(datos.jugador_y>datos.posicionTrampas[i].y+datos.posicionTrampas[i].alto)&&(!(datos.jugador_x+datos.jugador_ancho<datos.posicionTrampas[i].x+datos.desplazamientoEscenario+datos.movTrampa)&&!(datos.jugador_x>datos.posicionTrampas[i].x+datos.posicionTrampas[i].ancho+datos.desplazamientoEscenario+datos.movTrampa)))}for(var i=0;i<datos.posicionEnemigos.length;i++)reaccionandoAColisionesConEnemigos(colisionesEnemigos(i),i);function colisionesEnemigos(i){return!(datos.jugador_y+datos.jugador_alto<datos.posicionEnemigos[i].y)&&(!(datos.jugador_y>datos.posicionEnemigos[i].y+datos.posicionEnemigos[i].alto)&&(!(datos.jugador_x+datos.jugador_ancho<datos.posicionEnemigos[i].x+datos.desplazamientoEscenario)&&!(datos.jugador_x>datos.posicionEnemigos[i].x+datos.posicionEnemigos[i].ancho+datos.desplazamientoEscenario)))}function reaccionandoAColisionesConEnemigos(colision,i){colision&&datos.jugador_y+datos.jugador_alto<datos.posicionEnemigos[i].y+datos.gravedad&&(datos.gravedad=0,datos.jugador_y=datos.posicionEnemigos[i].y-datos.jugador_alto),colision&&datos.jugador_y-datos.gravedad>datos.posicionEnemigos[i].y+datos.posicionEnemigos[i].alto&&(datos.gravedad=1,datos.jugador_y=datos.posicionEnemigos[i].y+datos.posicionEnemigos[i].alto),movimiento=datos.desplazamientoEscenario<=datos.limiteEscenario?datos.movimientoJugador:-datos.movimiento,colision&&datos.jugador_x+datos.jugador_ancho<datos.posicionEnemigos[i].x+movimiento+datos.desplazamientoEscenario&&(datos.desplazamientoEscenario<=datos.limiteEscenario?datos.movimientoJugador=0:datos.movimiento=0,datos.jugador_x=datos.posicionEnemigos[i].x-datos.jugador_ancho+datos.desplazamientoEscenario),colision&&datos.jugador_x+-movimiento>datos.posicionEnemigos[i].x+datos.posicionEnemigos[i].ancho+datos.desplazamientoEscenario&&(datos.desplazamientoEscenario<=datos.limiteEscenario?datos.movimientoJugador=0:datos.movimiento=0,datos.jugador_x=datos.posicionEnemigos[i].x+datos.posicionEnemigos[i].ancho+datos.desplazamientoEscenario),datos.salto&&0===datos.gravedad&&datos.jugador_y+datos.jugador_alto==datos.posicionEnemigos[i].y&&(datos.gravedad=datos.alturaSalto)}for(var i=0;i<datos.posicionMonedas.length;i++)if(colisionMonedas(i)){sonidos.sMonedas.play(),datos.imgMonedas[i].src=datos.imgColisionesMonedas.src,datos.posicionMonedas[i].y--,datos.monedasColisionadas.includes(i)||(datos.contadorMonedas+=10,datos.contadorMonedasNivel+=10,document.getElementById("contadorMonedas").innerHTML=datos.contadorMonedas,datos.monedasColisionadas[datos.monedasColisionadas.length]=i);var moneda=i;setTimeout(function(){datos.posicionMonedas[moneda].x=-500,datos.posicionMonedas[moneda].y=-500},500)}function colisionMonedas(i){return!(datos.jugador_y+datos.jugador_alto<datos.posicionMonedas[i].y)&&(!(datos.jugador_y>datos.posicionMonedas[i].y+datos.posicionMonedas[i].alto)&&(!(datos.jugador_x+datos.jugador_ancho<datos.posicionMonedas[i].x+datos.desplazamientoEscenario)&&!(datos.jugador_x>datos.posicionMonedas[i].x+datos.posicionMonedas[i].ancho+datos.desplazamientoEscenario)))}function colisionesBalas(i){return!(datos.jugador_y+datos.jugador_alto<datos.posicionBalasEnemigos[i].y)&&(!(datos.jugador_y>datos.posicionBalasEnemigos[i].y+datos.posicionBalasEnemigos[i].alto)&&(!(datos.jugador_x>datos.posicionBalasEnemigos[i].x+datos.posicionBalasEnemigos[i].ancho+datos.desplazamientoEscenario)&&!(datos.jugador_x+datos.jugador_ancho<datos.posicionBalasEnemigos[i].x+datos.desplazamientoEscenario)))}function colisionBalas(idBalaJugador,idBalaEnemigo){return!(datos.disparo_y[idBalaJugador]+datos.disparo_alto[idBalaJugador]<datos.posicionBalasEnemigos[idBalaEnemigo].y)&&(!(datos.disparo_y[idBalaJugador]>datos.posicionBalasEnemigos[idBalaEnemigo].y+datos.posicionBalasEnemigos[idBalaEnemigo].alto)&&(!(datos.disparo_x[idBalaJugador]+datos.disparo_ancho[idBalaJugador]<datos.posicionBalasEnemigos[idBalaEnemigo].x+datos.desplazamientoEscenario)&&!(datos.disparo_x[idBalaJugador]>datos.posicionBalasEnemigos[idBalaEnemigo].x+datos.posicionBalasEnemigos[idBalaEnemigo].ancho+datos.desplazamientoEscenario)))}if(datos.posicionBalasEnemigos.forEach(function(elem,index){(datos.posicionEnemigos[index].x>datos.jugador_x-datos.desplazamientoEscenario&&datos.posicionEnemigos[index].x<1e3-datos.desplazamientoEscenario||elem.x<datos.posicionEnemigos[index].x)&&(elem.x-=datos.velocidadBalasEnemigos),elem.x<=-datos.desplazamientoEscenario&&(elem.x=datos.posicionEnemigos[index].x)}),datos.posicionBalasEnemigos.forEach(function(elem,index){colisionesBalas(index)&&(sonidos.sColisionBalasEnemigo.play(),sonidos.sEnergia.play(),datos.imgBalasEnemigos[index].src=datos.imgColisionesBalasEnemigos.src,datos.imgJugador.src=datos.imgColisionTrampa.src,datos.energia-=datos.energiaBalas,datos.penalizacionEnergia+=datos.energiaBalas,setTimeout(function(){datos.imgBalasEnemigos[index].src=datos.imgDisparoEnemigos.src,datos.imgJugador.src=datos.imgStopRight.src},100))}),datos.disparo_x.forEach(function(elem,i){datos.disparo_x[i]+="der"==datos.direccionDisparo[i]?datos.velocidadDisparoJugador:-datos.velocidadDisparoJugador,(datos.disparo_x[i]<=datos.desplazamientoEscenario||datos.disparo_x[i]>1e3)&&(datos.disparo_x.splice(i,1),datos.disparo_y.splice(i,1),datos.direccionDisparo.splice(i,1))}),datos.disparo_x.forEach(function(elem1,i){datos.posicionBalasEnemigos.forEach(function(elem2,x){colisionBalas(i,x)&&(sonidos.sColisionBalasEnemigo.play(),datos.imgDisparoJugador[i].src=datos.imgColisionesBalas.src,datos.posicionBalasEnemigos[x].x=datos.posicionEnemigos[x].x,datos.disparo_alto[i]=50,datos.disparo_ancho[i]=50,datos.disparo_y[i]-=25,setTimeout(function(i){datos.disparo_x.splice(i,1),datos.disparo_y.splice(i,1),datos.direccionDisparo.splice(i,1),datos.imgDisparoJugador.splice(i,1),datos.disparo_alto.splice(i,1),datos.disparo_ancho.splice(i,1)},200))})}),datos.energia<0&&(datos.energia=0),document.getElementById("barraEnergia").value=datos.energia,document.getElementById("porcentajeEnergia").innerHTML=Math.round(datos.energia)+"%",datos.energia<=0&&(datos.reiniciar=!0),animacion=frame(juego.tiempo),datos.jugador_x>=1e3-datos.jugador_ancho){cancelAnimationFrame(animacion),document.getElementById("final").style.display="block",sonidos.sGanar.play(),1!=datos.nivel&&"1"!=datos.nivel||sonidos.sBackground01.pause(),2!=datos.nivel&&"2"!=datos.nivel||sonidos.sBackground02.pause(),3!=datos.nivel&&"3"!=datos.nivel||sonidos.sBackground03.pause(),datos.incrementoPuntaje=datos.puntajeTotal,datos.puntajeNivel=Math.round(datos.contadorMonedasNivel-datos.penalizacionEnergia-datos.penalizacionVidas),document.getElementById("spnMonedasRecogidas").innerHTML=datos.contadorMonedasNivel,document.getElementById("energiaFinal").value=datos.energia,document.getElementById("spnTotalEnergia").innerHTML=Math.round(datos.energia)+" %",document.getElementById("puntosEnergia").innerHTML="-"+Math.round(datos.penalizacionEnergia)+" pts",datos.vida<3&&(document.getElementById("imgVidaFinal3").src=datos.imgVidaMenos.src),datos.vida<2&&(document.getElementById("imgVidaFinal2").src=datos.imgVidaMenos.src),document.getElementById("spnPtsVida").innerHTML="-"+datos.penalizacionVidas+" pts";var intervalo=setInterval(function(){datos.incrementoPuntaje>=datos.puntajeTotal+datos.puntajeNivel?(datos.puntajeTotal+=datos.incrementoPuntaje,document.getElementById("puntajeNivel").innerHTML="Nivel: "+datos.puntajeNivel+" - Total: "+datos.puntajeTotal+" pts",sonidos.sPuntos.play(),sonidos.sMonedero.pause(),clearInterval(intervalo),sonidos.sResumenPuntaje.play(),setTimeout(function(){juego.finalizaNivel()},5e3)):(datos.incrementoPuntaje++,sonidos.sMonedero.play(),document.getElementById("puntajeNivel").innerHTML="Nivel: "+datos.puntajeNivel+" - Total: "+datos.incrementoPuntaje+" pts")},16)}function juegoTerminado(){cancelAnimationFrame(animacion),document.getElementById("gameOver").style.display="block",datos.gameOver=!0,sonidos.sPerder.play(),juego.detenerMusicaDeFondo(),sonidos.sColisionBalasEnemigo.pause(),sonidos.sColisionTrampasEnemigos.pause(),setTimeout(function(){window.location.reload()},1e4)}},salir:function(){window.location.reload()},finalizaNivel:function(){var xhr=new XMLHttpRequest,completado="true",puntaje=datos.puntajeTotal,nivel=datos.puntajeNivel,idUsuario=datos.id,url="views/ajax/usuarios.php";xhr.open("POST",url,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send("completado=true&puntaje="+puntaje+"&nivel="+nivel+"&id="+idUsuario),xhr.onreadystatechange=function(){200==xhr.status&&4==xhr.readyState&&setTimeout(function(){juego.resetearDatos(),juego.detenerMusicaDeFondo(),datos.nivel<3?inicio.siguienteNivel():window.location="inicio"},5e3)}},resetearDatos:function(){datos.gravedad=0,datos.jugador_x=70,datos.jugador_y=200,datos.movimiento=0,datos.desplazamientoEscenario=0,datos.movimientoJugador=0,datos.penalizacionEnergia=0,datos.energia<=0&&(datos.energia=100)},detenerMusicaDeFondo:function(){switch(datos.nivel){case"1":case 1:sonidos.sBackground01.pause();break;case"2":case 2:sonidos.sBackground02.pause();break;case"3":case 3:sonidos.sBackground03.pause()}sonidos.sResumenPuntaje.pause()}};